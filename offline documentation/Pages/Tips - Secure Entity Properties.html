<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title>LCG - Tips - Secure Entity Properties</title>
	<link rel="stylesheet" type="text/css" href="../Styles/Highlight.css">
	<link rel="stylesheet" type="text/css" href="../Styles/Styles.css">
</head>
<body>
	<h1>Tips - Secure Entity Properties</h1>
	<section>
		<p>Use the <span class="text-bold">SecureObjectHelper</span> class to encrypt the entities properties. This class is welcome when using WCF without HTTPS support.</p>
		<p>Let's take an example with the following entity (generated or not)</p>
		<pre class="hl"><span class="hl kwa">public class</span> Document
<span class="hl opt">{</span>
    <span class="hl kwa">public</span> <span class="hl kwb">long</span> Id <span class="hl opt">{</span> <span class="hl kwa">get</span><span class="hl opt">;</span> <span class="hl kwa">set</span><span class="hl opt">; }</span>

    <span class="hl kwa">public</span> <span class="hl kwb">string</span> Title <span class="hl opt">{</span> <span class="hl kwa">get</span><span class="hl opt">;</span> <span class="hl kwa">set</span><span class="hl opt">; }</span>

    <span class="hl kwa">public</span> <span class="hl kwb">string</span> Author <span class="hl opt">{</span> <span class="hl kwa">get</span><span class="hl opt">;</span> <span class="hl kwa">set</span><span class="hl opt">; }</span>

    <span class="hl kwa">public</span> <span class="hl kwb">string</span> Description <span class="hl opt">{</span> <span class="hl kwa">get</span><span class="hl opt">;</span> <span class="hl kwa">set</span><span class="hl opt">; }</span>

    <span class="hl kwa">public</span> <span class="hl kwb">string</span> Content <span class="hl opt">{</span> <span class="hl kwa">get</span><span class="hl opt">;</span> <span class="hl kwa">set</span><span class="hl opt">; }</span>
<span class="hl opt">}</span></pre>
		<p class="action">Define the following extension methods</p>
        <pre class="hl"><span class="hl slc">// Models | Document.custom.cs or Extensions\DocumentExtensions.cs</span>
		
<span class="hl kwa">public static class</span> DocumentExtensions
<span class="hl opt">{</span>
    <span class="hl kwa">private static</span> IEnumerable<span class="hl opt">&lt;</span>SecurePropertyInfo<span class="hl opt">&gt;</span> <span class="hl kwd">GetSecurePropertyInfo</span><span class="hl opt">(</span><span class="hl kwa">this</span> Document source<span class="hl opt">)</span>
    <span class="hl opt">{</span>
        <span class="hl slc">// 1. Define the private key (static or dynamic)</span>

        <span class="hl kwb">string</span> privateKey <span class="hl opt">=</span> <span class="hl str">&quot;private_key_for_Document&quot;</span><span class="hl opt">;</span>

        <span class="hl slc">// 2. Define the provider to use</span>

        <span class="hl slc">// Here we use the TripleDesSecurePropertyProvider provider to encrypt some string properties</span>

        ISecurePropertyProvider provider <span class="hl opt">=</span> <span class="hl kwa">new</span> <span class="hl kwd">TripleDesSecurePropertyProvider</span><span class="hl opt">(</span>privateKey<span class="hl opt">);</span>

        <span class="hl slc">// 3. Define the properties to encrypt</span>

        <span class="hl kwa">return new</span> List<span class="hl opt">&lt;</span>SecurePropertyInfo<span class="hl opt">&gt;</span>
        <span class="hl opt">{</span>
            <span class="hl kwa">new</span> <span class="hl kwd">SecurePropertyInfo</span><span class="hl opt">(() =&gt;</span> source<span class="hl opt">.</span><span class="text-red">Author</span><span class="hl opt">,</span> provider<span class="hl opt">),</span>  <span class="hl slc">// Author property</span>
            <span class="hl kwa">new</span> <span class="hl kwd">SecurePropertyInfo</span><span class="hl opt">(() =&gt;</span> source<span class="hl opt">.</span><span class="text-red">Content</span><span class="hl opt">,</span> provider<span class="hl opt">)</span>  <span class="hl slc">// Content property</span>
        <span class="hl opt">};</span>
    <span class="hl opt">}</span>

    <span class="hl kwa">public static</span> <span class="hl kwb">void</span> <span class="hl kwd">SecureProperties</span><span class="hl opt">(</span><span class="hl kwa">this</span> Document source<span class="hl opt">)</span>
    <span class="hl opt">{</span>
        <span class="hl kwa">if</span> <span class="hl opt">(</span>source <span class="hl opt">!=</span> <span class="hl kwa">null</span><span class="hl opt">)</span>
        <span class="hl opt">{</span>
            <span class="text-red">SecureObjectHelper.Secure(</span>source<span class="hl opt">,</span> <span class="hl kwd">GetSecurePropertyInfo</span><span class="hl opt">(</span>source<span class="hl opt">)</span><span class="text-red">);</span>
        <span class="hl opt">}</span>
    <span class="hl opt">}</span>

    <span class="hl kwa">public static</span> <span class="hl kwb">void</span> <span class="hl kwd">UnsecureProperties</span><span class="hl opt">(</span><span class="hl kwa">this</span> Document source<span class="hl opt">)</span>
    <span class="hl opt">{</span>
        <span class="hl kwa">if</span> <span class="hl opt">(</span>source <span class="hl opt">!=</span> <span class="hl kwa">null</span><span class="hl opt">)</span>
        <span class="hl opt">{</span>
            <span class="text-red">SecureObjectHelper.Secure(</span>source<span class="hl opt">,</span> <span class="hl kwd">GetSecurePropertyInfo</span><span class="hl opt">(</span>source<span class="hl opt">)</span><span class="text-red">);</span>
        <span class="hl opt">}</span>
    <span class="hl opt">}</span>
<span class="hl opt">}</span></pre>
        <p>Usage</p>
        <pre class="hl"><span class="hl slc">// Client-side...</span>

Document doc <span class="hl opt">=</span> <span class="hl kwa">new</span> Document
<span class="hl opt">{</span>
    Id <span class="hl opt">=</span> <span class="hl num">1</span><span class="hl opt">,</span>
    Title <span class="hl opt">=</span> <span class="hl str">&quot;Title&quot;</span><span class="hl opt">,</span>
    Author <span class="hl opt">=</span> <span class="hl str">&quot;Author&quot;</span><span class="hl opt">,</span>
    Description <span class="hl opt">=</span> <span class="hl str">&quot;Description&quot;</span><span class="hl opt">,</span>
    Content <span class="hl opt">=</span> <span class="hl str">&quot;Content&quot;</span>
<span class="hl opt">};</span>

doc<span class="hl opt">.</span><span class="text-red">SecureProperties()</span><span class="hl opt">;</span>


<span class="hl slc">// Server-side...</span>

doc<span class="hl opt">.</span><span class="text-red">UnsecureProperties()</span><span class="hl opt">;</span></pre>
		<p>Encrypted properties</p>
		<img src="../ScreenShots/SecureEntityProperties-01.png" title="Illustration" alt="Illustration" />
		<div class="box warning">
		    <h3>Database Storage</h3>
		    <div class="box-content">When storing encrypted data do not forget to use a column with enough characters (or VARCHAR(MAX)) to contain the encrypted values.</div>
		</div>
	</section>
</body>
</html>
