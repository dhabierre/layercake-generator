<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>LCG - 08 - Data Logging Support</title>
    <link rel="stylesheet" type="text/css" href="../Styles/Highlight.css">
    <link rel="stylesheet" type="text/css" href="../Styles/Styles.css">
</head>
<body>
    <h1>Lab 08 - Data Logging Support</h1>
    <section>
        <p>Duration: <span class="text-bold">~5mins</span></p>
        <p>Databases contain some of the most sensitive data, customer records, financial data, product records and more.</p>
        <p>Audit records of data are vital to have in order to understand who accessed or changed what data when.</p>
    </section>
    <section>
        <h2>1. Database Setup</h2>
        <p>Set up the Data Logging is really simple. Remember the <span class="text-bold">Client</span> table from previous Labs.</p>
        <img src="../ScreenShots/08-01.png" title="Illustration" alt="Illustration" />
        <p>Imagine we want to log record modifications on this table (update and delete operations).</p>
        <p class="action">Create a new table named <span class="text-bold">Client_LOGS</span> without constraint.</p>
        <img src="../ScreenShots/08-02.png" title="Illustration" alt="Illustration" />
        <div class="box warning">
            <h3>Data Logging Table</h3>
            <ul>
                <li>No primary key</li>
                <li>No foreign key (no relationship with other tables)</li>
                <li>No unique constraint</li>
                <li>The data logging table name must follow the <span class="text-bold">&lt;TABLE_NAME&gt;_LOGS</span> pattern</li>
                <li>This table must have the same columns as the original one</li>
                <li>Each column must allow NULL value</li>
            </ul>
        </div>
        <p>And that's all!</p>
        <h2>2. Code</h2>
        <p>Code sample (as you can see there is nothing special).</p>
        <pre class="hl"><span class="hl kwa">var</span> client <span class="hl opt">=</span> <span class="hl kwa">new</span> Client <span class="hl opt">{</span> IdCountry <span class="hl opt">=</span> country<span class="hl opt">.</span>Id<span class="hl opt">,</span> Firstname <span class="hl opt">=</span> <span class="hl str">&quot;John&quot;</span><span class="hl opt">,</span> Lastname <span class="hl opt">=</span> <span class="hl str">&quot;Doe&quot;</span><span class="hl opt">,</span> Email <span class="hl opt">=</span> <span class="hl str">&quot;john.doe&#64;skynet.net&quot;</span><span class="hl opt">,</span> Ref <span class="hl opt">=</span> <span class="hl num">1234</span> <span class="hl opt">};</span>

<span class="hl kwa">using</span> <span class="hl opt">(</span><span class="hl kwa">var</span> service <span class="hl opt">=</span> <span class="hl kwa">new</span> ServiceProxy<span class="hl opt">&lt;</span>IClientService<span class="hl opt">&gt;())</span>
<span class="hl opt">{</span>
    service<span class="hl opt">.</span>Proxy<span class="hl opt">.</span><span class="hl kwd">Save</span><span class="hl opt">(</span>_userContext<span class="hl opt">,</span> <span class="hl kwa">ref</span> client<span class="hl opt">);</span>    <span class="hl slc">// Creation</span>

    client<span class="hl opt">.</span>Email <span class="hl opt">=</span> <span class="hl str">&quot;jdoe&#64;skynet.net&quot;</span><span class="hl opt">;</span>

    service<span class="hl opt">.</span>Proxy<span class="hl opt">.</span><span class="hl kwd">Save</span><span class="hl opt">(</span>_userContext<span class="hl opt">,</span> <span class="hl kwa">ref</span> client<span class="hl opt">);</span>    <span class="hl slc">// Update</span>

    service<span class="hl opt">.</span>Proxy<span class="hl opt">.</span><span class="hl kwd">Delete</span><span class="hl opt">(</span>_userContext<span class="hl opt">,</span> client<span class="hl opt">);</span>      <span class="hl slc">// Delete</span>
<span class="hl opt">}</span></pre>
        <p><span class="text-bold">Client_LOGS</span> records</p>
		<img src="../ScreenShots/08-03.png" title="Illustration" alt="Illustration" />
		<ul>
			<li>The first record is stored before the Update operation</li>
			<li>The second record is stored before the Delete operation</li>
		</ul>
		<p>Data logging tables can be created, deleted and truncated at any time.</p>
        <p>It is possible to combine data logging with data ownership. This feature will be explained in a next lab.</p>
    </section>
</body>
</html>
