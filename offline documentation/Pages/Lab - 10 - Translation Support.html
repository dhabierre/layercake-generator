<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>LCG - 10 - Translation Support</title>
    <link rel="stylesheet" type="text/css" href="../Styles/Highlight.css">
    <link rel="stylesheet" type="text/css" href="../Styles/Styles.css">
</head>
<body>
    <h1>Lab 10 - Translation Support</h1>
    <section>
        <p>Duration: <span class="text-bold">~5mins</span></p>
    </section>
    <section>
        <p>LayerCake populates the<span class="text-bold">Translation</span> table.</p>
		<p>This table contains entity validation errors and custom translations.</p>
		<img src="../ScreenShots/10-01.png" title="Illustration" alt="Illustration" />
		<p>Custom records should be prefixed with the <span class="text-bold">Custom</span> string (but it is not necessary).</p>
		<pre class="hl"><span class="hl kwa">INSERT INTO [Labs]..[Translation] ([Translation_Key], [Translation_EN], [Translation_FR])</span>
<span class="hl kwa">VALUES</span>
<span class="hl opt">(</span>
    <span class="hl str">'<span class="text-red">Custom</span>ValueMustBeGreaterThanZero'</span><span class="hl opt">,</span>
    <span class="hl str">'The '</span><span class="hl str">'value'</span><span class="hl str">' parameter must be greater than 0'</span><span class="hl opt">,</span>
    <span class="hl str">'Le paramètre '</span><span class="hl str">'value'</span><span class="hl str">' doit être supérieur à 0'</span>
<span class="hl opt">)</span></pre>
		<p>To update the code (Core\Translations\{TranslationEnum.generated.cs, TranslationHelper.generated.cs}) use the <span class="text-bold">Extensions &gt; Generate Translations</span> option in LayerCake Generator.</p>
		<img src="../ScreenShots/10-02.png" title="Illustration" alt="Illustration" />
		<p>Use the <span class="text-bold">OperationException</span> class with <span class="text-bold">TranslationEnum</span> enumerations to pass messages from the server (business layer for example) to the client.</p>
		<pre class="hl"><span class="hl com">// Business | AppBusiness\MyClassBusiness.cs</span>

<span class="hl kwa">namespace</span> Com<span class="hl opt">.</span>Example<span class="hl opt">.</span>Labs<span class="hl opt">.</span>Business
<span class="hl opt">{</span>
    <span class="hl kwa">using</span> System<span class="hl opt">;</span>

    <span class="hl kwa">using</span> Com<span class="hl opt">.</span>Example<span class="hl opt">.</span>Labs<span class="hl opt">.</span>Core<span class="hl opt">;</span>

    <span class="hl opt">[</span><span class="hl kwd">BusinessClass</span><span class="hl opt">]</span>
    <span class="hl kwa">public class</span> MyClassBusiness <span class="hl opt">:</span> BusinessBase
    <span class="hl opt">{</span>
        <span class="hl opt">[</span><span class="hl kwd">BusinessMethod</span><span class="hl opt">]</span>
        <span class="hl kwa">public</span> <span class="hl kwb">void</span> <span class="hl kwd">MyMethod</span><span class="hl opt">(</span>IUserContext userContext<span class="hl opt">,</span> <span class="hl kwb">int</span> <span class="hl kwa">value</span><span class="hl opt">)</span>
        <span class="hl opt">{</span>
            <span class="hl kwa">if</span> <span class="hl opt">(</span><span class="hl kwa">value</span> <span class="hl opt">&lt;=</span> <span class="hl num">0</span><span class="hl opt">)</span>
            <span class="hl opt">{</span>
                <span class="highlight-text">throw new OperationException(TranslationEnum.ValueMustBeGreaterThanZero);</span>
            <span class="hl opt">}</span>

            <span class="hl slc">// ...</span>
        <span class="hl opt">}</span>
    <span class="hl opt">}</span>
<span class="hl opt">}</span></pre>
		<p>To get the translation message on client-side.</p>
		<pre class="hl"><span class="hl com">// Client-side</span>

<span class="hl kwa">try</span>
<span class="hl opt">{</span>
    <span class="hl kwa">using</span> <span class="hl opt">(</span><span class="hl kwa">var</span> service <span class="hl opt">=</span> <span class="hl kwa">new</span> ServiceProxy<span class="hl opt">&lt;</span>IMyClassService<span class="hl opt">&gt;())</span>
    <span class="hl opt">{</span>
        service<span class="hl opt">.</span>Proxy<span class="hl opt">.</span><span class="hl kwd">MyMethod</span><span class="hl opt">(</span>ClientContext<span class="hl opt">.</span>Anonymous<span class="hl opt">, -</span><span class="hl num">1</span> <span class="hl com">/* bad value... */</span><span class="hl opt">);</span>
    <span class="hl opt">}</span>
<span class="hl opt">}</span>
<span class="hl kwa">catch</span> <span class="hl opt">(</span>OperationException x<span class="hl opt">)</span>
<span class="hl opt">{</span>
    <span class="hl kwa">foreach</span> <span class="hl opt">(</span><span class="hl kwa">var</span> translation <span class="hl kwa">in</span> x<span class="hl opt">.</span>Translations<span class="hl opt">)</span>
    <span class="hl opt">{</span>
        <span class="hl slc">// Try to get the user's culture from:</span>
        <span class="hl slc">//  1. the HttpContext.Current.Session[&quot;UserContext&quot;] if existing (Web context)</span>
        <span class="hl slc">//  2. the first culture defined by the browser                   (Web context)</span>
        <span class="hl slc">//  2. the system culture</span>
        <span class="hl slc">//  4. the default culture (Cultures.Default)</span>

        MessageBox<span class="hl opt">.</span><span class="hl kwd">Show</span><span class="hl opt">(</span>
            <span class="highlight-text">TranslationResolver.Current.GetMessage(translation)</span><span class="hl opt">);</span>

        <span class="hl slc">// or...</span>

        MessageBox<span class="hl opt">.</span><span class="hl kwd">Show</span><span class="hl opt">(</span>
            <span class="highlight-text">TranslationResolver.Current.GetMessage(translation, CurrentUser.Culture)</span><span class="hl opt">);</span> <span class="hl slc">// ... where CurrentUser is User instance</span>

        <span class="hl slc">// or...</span>

        <span class="hl slc">// Get the FR string</span>
        MessageBox<span class="hl opt">.</span><span class="hl kwd">Show</span><span class="hl opt">(</span>
            <span class="highlight-text">TranslationResolver.Current.GetMessage(translation, Cultures.FR)</span><span class="hl opt">);</span> 
    <span class="hl opt">}</span>
<span class="hl opt">}</span></pre>
    </section>
</body>
</html>
