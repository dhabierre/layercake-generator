<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title>LCG - HowTo - Local ServiceProxy</title>
	<link rel="stylesheet" type="text/css" href="../Styles/Highlight.css">
	<link rel="stylesheet" type="text/css" href="../Styles/Styles.css">
</head>
<body>
	<h1>HowTo - Local ServiceProxy</h1>
	<section>
		<p>The <span class="text-bold">ServiceProxy&lt;T&gt;</span> class is used by the clients to get a WCF channel to access to the <span class="text-bold">WebServices</span> layer over network.</p>
		<p>When developping a WebSite (can be seen as client/consumer of the WebServices) that is hosted on the same server as the WebServices layer, it is possible to get local instances and by-pass the WCF communication to increase performances.</p>
	</section>
	<section>
		<h2>1. Projects Configuration</h2>
		<p>Repeat these actions with the following projects</p>
		<ul>
		    <li>Com.Example.Labs.Business</li>
		    <li>Com.Example.Labs.Crud</li>
		    <li>Com.Example.Labs.Services</li>
		</ul>
		<p class="action">Go to the <span class="text-bold">Properties</span> of the WebSite project.</p>
		<p class="action">Go to <span class="text-bold">Build Events</span> and add the following line in the <span class="text-bold">Post-build Event</span> section.</p>
		<pre class="hl">xcopy /y "$(TargetDir)$(TargetName).dll" "$(SolutionDir)<span class="text-italic">Com.Company.Project.WebSite</span>\bin"
xcopy /y "$(TargetDir)$(TargetName).pdb" "$(SolutionDir)<span class="text-italic">Com.Company.Project.WebSite</span>\bin"</pre>
		<p>Example</p>
		<img src="../ScreenShots/LocalServiceProxy-01.png" title="Illustration" alt="Illustration" />
		<div class="box warning">
		    <h3>Important</h3>
		    <ul>
		        <li>Use <span class="text-bold">Build Events</span>. The WebSite project <span class="text-bold">MUST NOT HAVE REFERENCES</span> on the <em>Business</em> <em>Crud</em> and <em>Services</em> assemblies.</li>
		        <li>
		            <div>Use the ServiceProxy class to get service instances. You shouldn't use <em>Services</em> assembly directly (must not be referenced).</div>
		            <div>
		                <pre class="hl"><span class="hl kwa">using</span> <span class="hl opt">(</span><span class="hl kwa">var</span> service <span class="hl opt">=</span> <span class="hl kwa">new</span> ServiceProxy<span class="hl opt">&lt;</span>IMyService<span class="hl opt">&gt;())</span>
<span class="hl opt">{</span>
    service<span class="hl opt">.</span>Proxy<span class="hl opt">.</span><span class="hl kwd">MyMethod</span><span class="hl opt">();</span>
<span class="hl opt">}</span></pre>
					</div>
				</li>
				<li>WebSite Publishing operation does not copy <em>Business</em> <em>Crud</em> and <em>Services</em> assemblies in the bin\ folder of the WebSite. Do not forget to do it manually!</li>
			</ul>
		</div>
	</section>
	<section>
		<h2>2. Web.config Configuration</h2>
		<p class="action">Edit the <span class="text-bold">Web.config</span> of the WebSite.</p>
		<pre class="hl"><span class="hl kwa">&lt;serviceProxyConfiguration</span>
  <span class="hl kwb">isLocal</span>=<span class="hl text-red text-bold">&quot;True&quot;</span> <span class="hl kwa">/&gt;</span></pre>
    <p class="action">Do not forget to add the connection string required by the <em>Crud</em> (can be found in the App.config file of the Unit Tests).</p>
    <pre class="hl"><span class="hl kwa">&lt;connectionStrings&gt;</span>
  <span class="hl kwa">&lt;add</span>
    <span class="hl kwb">name</span>=<span class="hl str">&quot;Default&quot;</span>
    <span class="hl kwb">connectionString</span>=<span class="hl str">&quot;Data Source=localhost;Initial Catalog=Labs;Integrated Security=SSPI;&quot;</span> <span class="hl kwa">/&gt;</span>
<span class="hl kwa">&lt;/connectionStrings&gt;</span></pre>
		<p>Now the <span class="text-bold">ServiceProxy&lt;T&gt;</span> class will create local instances without using the WCF communication.</p>
		<p>On WebSite-side nothing changes</p>
		<pre class="hl"><span class="hl kwa">using</span> <span class="hl opt">(</span><span class="hl kwa">var</span> service <span class="hl opt">=</span> <span class="hl kwa">new</span> ServiceProxy<span class="hl opt">&lt;</span>IMyService<span class="hl opt">&gt;())</span>
<span class="hl opt">{</span>
    service<span class="hl opt">.</span>Proxy<span class="hl opt">.</span><span class="hl kwd">MyMethod</span><span class="hl opt">();</span>
<span class="hl opt">}</span></pre>
	</section>
</body>
</html>
